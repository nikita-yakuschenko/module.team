# Деплой через Dokploy

## Подготовка

Проект уже настроен для деплоя через Dokploy. Все необходимые файлы созданы:

- ✅ `Dockerfile` - для сборки образа
- ✅ `.dockerignore` - исключает ненужные файлы
- ✅ `next.config.ts` - настроен standalone режим
- ✅ `docker-compose.yml` - опционально, для локальной проверки

## Шаги деплоя в Dokploy

### 1. Подключите репозиторий

1. Войдите в Dokploy
2. Создайте новый проект
3. Подключите ваш Git репозиторий (GitHub, GitLab, Bitbucket)
4. Выберите ветку (обычно `main` или `master`)

### 2. Настройки проекта в Dokploy

**Build Settings:**
- **Build Command**: (оставьте пустым, Dokploy использует Dockerfile)
- **Dockerfile Path**: `Dockerfile` (или оставьте по умолчанию)
- **Docker Context**: `.` (корень проекта)

**Environment Variables** (если нужны):
- `NODE_ENV=production`
- Любые другие переменные окружения вашего приложения

**Port Settings:**
- **Port**: `3000` (внутренний порт контейнера)
- Dokploy автоматически пробросит порт наружу

### 3. Деплой

1. Нажмите "Deploy" или "Build & Deploy"
2. Dokploy автоматически:
   - Клонирует репозиторий
   - Соберет Docker образ используя Dockerfile
   - Запустит контейнер
   - Настроит reverse proxy (если используется)

### 4. Автоматический деплой

Dokploy может автоматически деплоить при пуше в репозиторий:
- Включите "Auto Deploy" в настройках проекта
- При каждом push в выбранную ветку будет автоматический деплой

## Проверка деплоя

После деплоя:
1. Проверьте логи в Dokploy
2. Откройте URL, который предоставил Dokploy
3. Приложение должно быть доступно

## Обновление приложения

### Через Git:
```bash
git add .
git commit -m "Update app"
git push
```
Если включен Auto Deploy - деплой произойдет автоматически

### Вручную в Dokploy:
1. Откройте проект в Dokploy
2. Нажмите "Redeploy" или "Rebuild"

## Troubleshooting

### Проблема: Сборка падает

**Решение:**
- Проверьте логи сборки в Dokploy
- Убедитесь, что `next.config.ts` содержит `output: 'standalone'`
- Проверьте, что все зависимости указаны в `package.json`

### Проблема: Приложение не запускается

**Решение:**
- Проверьте логи контейнера в Dokploy
- Убедитесь, что порт 3000 правильно настроен
- Проверьте переменные окружения

### Проблема: Статические файлы не загружаются

**Решение:**
- Убедитесь, что папка `public` скопирована в Dockerfile
- Проверьте пути к файлам в коде

## Структура файлов для Dokploy

```
.
├── Dockerfile          # Основной файл для сборки
├── .dockerignore       # Исключает файлы из образа
├── docker-compose.yml  # Опционально, для локальной проверки
├── next.config.ts      # Конфигурация Next.js (standalone режим)
├── package.json        # Зависимости
└── ...                 # Остальные файлы проекта
```

## Дополнительные настройки

### Переменные окружения

Если нужны переменные окружения, добавьте их в настройках проекта Dokploy:
- `NODE_ENV=production`
- `NEXT_PUBLIC_*` - для переменных, доступных в браузере

### Custom Domain

В Dokploy можно настроить собственный домен:
1. Добавьте домен в настройках проекта
2. Настройте DNS записи (A или CNAME)
3. Dokploy автоматически настроит SSL через Let's Encrypt

## Полезные ссылки

- [Dokploy Documentation](https://dokploy.com/docs)
- [Next.js Docker Deployment](https://nextjs.org/docs/deployment#docker-image)
